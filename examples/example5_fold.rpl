// Example 5: State Accumulation (fold operator)
// Demonstrates stateful stream computation

source numbers : int := 0;

// fold(stream, initial, (acc, x) => expr)
// Simple folds - single line is clear enough
stream sum <- fold(numbers, 0, (acc, x) => acc + x);
stream product <- fold(numbers, 1, (acc, x) => acc * x);
stream count <- fold(numbers, 0, (acc, x) => acc + 1);

// Complex fold with conditional - multi-line for clarity
stream max_val <- fold(numbers, 0, (acc, x) =>
    if x > acc
        then x
        else acc
    end
);

// Derived computation with let (no 'end' for let)
stream average <-
    let s = sum in
    let c = count in
    if c > 0
        then s / c
        else 0
    end;

sink sum_out <- sum;
sink count_out <- count;
sink avg_out <- average;
sink max_out <- max_val;

// Input sequence: 1, 2, 5, 3
// After 1: sum=1, count=1, avg=1.0, max=1
// After 5: sum=8, count=3, avg=2.67, max=5
